name: ðŸ¤– AI Review (Free Code Review)

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  code_review:
    name: Run AI-like review
    runs-on: ubuntu-latest

    steps:
      - name: Checkout PR branch
        uses: actions/checkout@v3

      # Python linters
      - name: Install Python linters
        run: |
          pip install flake8 bandit codespell

      - name: Run flake8
        uses: reviewdog/action-flake8@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          reporter: github-pr-review
          fail_on_error: false

      - name: Run bandit (security)
        uses: reviewdog/action-bandit@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          reporter: github-pr-review
          fail_on_error: false

      # Dockerfile
      - name: Install hadolint
        run: |
          sudo wget -O /usr/local/bin/hadolint \
            https://github.com/hadolint/hadolint/releases/download/v2.12.0/hadolint-Linux-x86_64
          sudo chmod +x /usr/local/bin/hadolint

      - name: Run hadolint
        uses: reviewdog/action-hadolint@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          reporter: github-pr-review
          fail_on_error: false

      # Shellcheck
      - name: Run shellcheck
        uses: reviewdog/action-shellcheck@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          reporter: github-pr-review
          fail_on_error: false

      # YAML check
      - name: Install yamllint
        run: sudo apt-get install -y yamllint

      - name: Run yamllint
        uses: reviewdog/action-yamllint@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          reporter: github-pr-review
          fail_on_error: false

      # Spell check
      - name: Spell check
        run: |
          codespell . | tee codespell.txt || true

      - name: Reviewdog spell report
        uses: reviewdog/action-suggester@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          tool_name: codespell
          fail_on_error: false
